{% extends "base.html" %}

{% load extras %}

{% block title %}Order -- {{object}}{% endblock %}

{% block page_title %}Order # {{order.number}}{% endblock page_title %}

{% block content %}
  
  <div class="well">
    {% if perms.orders.change_order %}
    <a href="{% url 'order_edit' object.pk %}" title="Edit Order">Edit Order</a>  
    {% endif %}
    {% if perms.orders.delete_order %}
      |  <a href="{% url 'order_delete' object.pk %}" title="Delete Order">Delete Order</a>
    {% endif %}
  </div>
  <hr/>

  {% if object.not_placed %}
    <div class="message error">Order has not been placed with the vendor!</div>
  {% endif %}

  <h3>Order Info</h3>
  <table id="order-detail-table" cell-spacing="0" cell-padding="0">
    <tr>
      <td>Order#</td><td>{{order.number}}</td>
    </tr>
    <tr>
      <td>Placed Date:</td><td>{{order.created|date:'j F, Y'}}</td>
    </tr>
    <tr>
      <td>Last Modified:</td><td>{{order.modified|date:'j F, Y'}}</td>
    </tr>
    <tr>
      <td>Status:</td><td>{{order.get_status_display|upper}}</td>
    </tr>
    <tr>
      <td>Store:</td><td>{{order.store}}</td>
    </tr>
    <tr>
      <td>Associate:</td>
      <td>
        {% for commission in order.commission_set.all %}
          {{ commission.associate.first_name }} <br/> 
        {% endfor %}
      </td>
    <tr>
      <td>Customer:</td><td>{{order.customer}}</td>
    </tr>
    <tr>
      <td>Customer Contact Details:</td>
      <td>
        Phone: {{order.customer.phone}}<br/>
        Email: {{order.customer.email}}
      </td>
    </tr>
    <tr>
      <td>Billing Address:</td>
      <td>{{order.customer.billing_address}}</td>
    </tr>
    <tr>
      <td>Shipping Address:</td>
      <td>{{order.customer.shipping_address}}</td>
    </tr>
  </table>

  <h3>Order Payment Info</h3>
  <table id="order-payments-table" cell-spacing="0" cell-padding="0">
    <tr>
      <td>Subtotal After Discount</td><td>{{order.subtotal_after_discount|dollars}}</td>
    </tr>
    <tr>
      <td>Tax</td><td>{{order.tax|dollars}}</td>
    </tr>
    <tr>
      <td>Shipping</td><td>{{order.shipping|dollars}}</td>
    </tr>
    <tr>
      <td>Grand Total</td><td>{{order.grand_total|dollars}}</td>
    </tr>
    <tr>
      <td>Deposit Balance</td><td>{{order.deposit_balance|dollars}}</td>
    </tr>
    <tr>
      <td>Balance Due</td><td>{{order.balance_due|dollars}}</td>
    </tr>
  </table>

  <h3>Ordered Items</h3>
  <table id="order-items-table" cell-spacing="0" cell-padding="0">
    <thead>
      <th>&nbsp;</th>
      <th>Status</th>
      <th>PO #</th>
      <th>PO Date</th>
      <th>Acknowledgement #</th>
      <th>Acknowledgement Date</th>
      <th>ETA</th>
    </thead>
    <tbody>
    {% for item in order.orderitem_set.all %}
      <tr>
        <td>{{ item.description }} <br/> </td>
        {% if item.in_stock %}
          <td>IN STOCK</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        {% else %}
          <td>{{ item.get_status_display|upper}}</td>
          <td>{{ item.po_num}}</td>
          <td>{{ item.po_date|date:'j F, Y'}}</td>
          <td>{{ item.ack_num}}</td>
          <td>{{ item.ack_date|date:'j F, Y'}}</td>
          <td>{{ item.eta|date:'j F, Y' }} </td>
        {% endif %}
      </tr>
    {% endfor %}
    </tbody>
  </table>

  <h3>Referral</h3>
  <p>{{order.referral}}</p>

  <h3>Comments</h3>
  <p>{{order.comments}}</p>

{% endblock content %}
